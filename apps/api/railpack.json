{
  "$schema": "https://schema.railpack.com",
  "steps": {
    "build": {
      "commands": [
        "npm ci",
        "npx nx build api --configuration=production",
        "mkdir -p apps/api/dist-deploy",
        "cp -r apps/api/dist/* apps/api/dist-deploy/",
        "cd apps/api && rm -rf dist && mv dist-deploy dist",
        "ls -la apps/api/dist/"
      ]
    }
  },
  "deploy": {
    "inputs": [
      {
        "step": "build",
        "include": ["apps/api/dist"]
      }
    ],
    "startCommand": "node apps/api/dist/main.js"
  }
}
